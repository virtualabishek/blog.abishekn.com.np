<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.abishekn.com.np/blog</id>
    <title>Abi's Blog</title>
    <updated>2026-01-06T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://blog.abishekn.com.np/blog"/>
    <subtitle>Technical articles and personal thoughts by Abishek Neupane</subtitle>
    <icon>https://blog.abishekn.com.np/img/favicon.ico</icon>
    <rights>Copyright © 2026 Abishek Neupane</rights>
    <entry>
        <title type="html"><![CDATA[eSewa vs Khalti: how I keep Nepali payments honest]]></title>
        <id>https://blog.abishekn.com.np/blog/esewa-vs-khalti-secure-payment-flow-nepal</id>
        <link href="https://blog.abishekn.com.np/blog/esewa-vs-khalti-secure-payment-flow-nepal"/>
        <updated>2026-01-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[ Explore the mostly used online payment gateways of Nepal: Esewa and Khalti and learned that anyone can change the payment amount in the browser. If we rely on that number, someone can buy a Rs 1000 item for Rs 1. Here is how I keep things honest with eSewa and Khalti.]]></summary>
        <content type="html"><![CDATA[<p>I explored the mostly used online payment gateways of Nepal: Esewa and Khalti and learned that anyone can change the payment amount in the browser. If we rely on that number, someone can buy a Rs 1000 item for Rs 1. Here is how I keep things honest with eSewa and Khalti.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-the-paranoia">Why the paranoia?<a href="https://blog.abishekn.com.np/blog/esewa-vs-khalti-secure-payment-flow-nepal#why-the-paranoia" class="hash-link" aria-label="Direct link to Why the paranoia?" title="Direct link to Why the paranoia?">​</a></h2>
<p>Browsers are editable. Inputs can be changed, scripts can be rerun, URLs can be faked. The only place that should decide whether money actually moved is your backend, not the page.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="esewa-signed-forms-with-hmac">eSewa: signed forms with HMAC<a href="https://blog.abishekn.com.np/blog/esewa-vs-khalti-secure-payment-flow-nepal#esewa-signed-forms-with-hmac" class="hash-link" aria-label="Direct link to eSewa: signed forms with HMAC" title="Direct link to eSewa: signed forms with HMAC">​</a></h2>
<ul>
<li>eSewa V2 gives you a secret key. You build a small string that includes the amount, product id, and that secret, then hash it with HMAC-SHA256.</li>
<li>You post the amount plus that signature to eSewa. On their side, they recompute the same hash. If it matches, the request is legit; if a user tampered with the amount, it fails.</li>
<li>After payment, eSewa redirects back with Base64 encoded JSON. I decode it, recompute the signature with my secret, and only then mark the order as paid. Anything that fails this check is logged and rejected.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="khalti-server-to-server-with-a-pidx">Khalti: server-to-server with a pidx<a href="https://blog.abishekn.com.np/blog/esewa-vs-khalti-secure-payment-flow-nepal#khalti-server-to-server-with-a-pidx" class="hash-link" aria-label="Direct link to Khalti: server-to-server with a pidx" title="Direct link to Khalti: server-to-server with a pidx">​</a></h2>
<ul>
<li>Khalti V2 is more API-first. My backend calls their API with <code>Authorization: Key &lt;secret&gt;</code> and the amount in paisa. Khalti responds with a <code>pidx</code> and a redirect URL.</li>
<li>The user pays on Khalti. When they come back with <code>?pidx=...</code>, I do not trust that alone. I call Khalti again and ask, "What is the status of this pidx?" Only their response flips the order to PAID.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-comparison">Quick comparison<a href="https://blog.abishekn.com.np/blog/esewa-vs-khalti-secure-payment-flow-nepal#quick-comparison" class="hash-link" aria-label="Direct link to Quick comparison" title="Direct link to Quick comparison">​</a></h2>
<table><thead><tr><th>What</th><th>eSewa (V2)</th><th>Khalti (V2)</th></tr></thead><tbody><tr><td>Setup</td><td>HTML form + signature</td><td>Backend API call</td></tr><tr><td>Trust anchor</td><td>HMAC-SHA256 signature</td><td>Bearer token + pidx lookup</td></tr><tr><td>Final check</td><td>Recompute signature locally</td><td>Ask Khalti server for status</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-i-actually-do-in-code">What I actually do in code<a href="https://blog.abishekn.com.np/blog/esewa-vs-khalti-secure-payment-flow-nepal#what-i-actually-do-in-code" class="hash-link" aria-label="Direct link to What I actually do in code" title="Direct link to What I actually do in code">​</a></h2>
<ol>
<li>When a user clicks Checkout, I fetch the merchant keys from a safe store (vault/env) and never expose them to the frontend.</li>
<li>For eSewa, I sign the payload with HMAC-SHA256 before redirecting; on callback I decode, re-sign, and compare.</li>
<li>For Khalti, I create the <code>pidx</code> server-side, redirect the user, and on callback I immediately call Khalti's verify endpoint.</li>
<li>Only after these checks do I update the order to PAID. Anything mismatched becomes an audit log entry.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="takeaways">Takeaways<a href="https://blog.abishekn.com.np/blog/esewa-vs-khalti-secure-payment-flow-nepal#takeaways" class="hash-link" aria-label="Direct link to Takeaways" title="Direct link to Takeaways">​</a></h2>
<ul>
<li>Never trust frontend amounts or statuses.</li>
<li>Keep secrets off the browser; everything sensitive happens on the backend.</li>
<li>Always verify after redirect: re-sign for eSewa, lookup for Khalti. Those two steps have saved me from fake Rs 1 checkouts.</li>
</ul>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Technical" term="Technical"/>
        <category label="Security" term="Security"/>
        <category label="Backend" term="Backend"/>
        <category label="Payments" term="Payments"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Secure Authentication in NestJS E-Commerce: JWT, Access Tokens, and Refresh Tokens Explained]]></title>
        <id>https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce</id>
        <link href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce"/>
        <updated>2025-12-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[A practical guide to implementing secure JWT-based authentication with access tokens and refresh tokens in a NestJS e-commerce project. Covers token generation, validation, refresh flow, security best practices, and real-world application in an online store.]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-what-is-jwt-json-web-token">1. What is JWT (JSON Web Token)?<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#1-what-is-jwt-json-web-token" class="hash-link" aria-label="Direct link to 1. What is JWT (JSON Web Token)?" title="Direct link to 1. What is JWT (JSON Web Token)?">​</a></h2>
<p>JWT is a compact, self-contained way to securely transmit information between parties as a JSON object. It's digitally signed, so it can be verified and trusted.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jwt-structure">JWT Structure<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#jwt-structure" class="hash-link" aria-label="Direct link to JWT Structure" title="Direct link to JWT Structure">​</a></h3>
<p>A JWT looks like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4ifQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It has <strong>3 parts</strong> separated by dots (<code>.</code>):</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">HEADER.PAYLOAD.SIGNATURE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-header">Part 1: Header<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#part-1-header" class="hash-link" aria-label="Direct link to Part 1: Header" title="Direct link to Part 1: Header">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"alg"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"HS256"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Algorithm used to sign (HMAC SHA256)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"typ"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"JWT"</span><span class="token plain">       </span><span class="token comment" style="color:rgb(98, 114, 164)">// Type of token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is Base64Url encoded → <code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-payload-claims">Part 2: Payload (Claims)<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#part-2-payload-claims" class="hash-link" aria-label="Direct link to Part 2: Payload (Claims)" title="Direct link to Part 2: Payload (Claims)">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"sub"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"82919d9f-7c7c-4e82-a613-3ce0b7bc523b"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Subject (user ID)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"email"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"user@example.com"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"role"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"seller"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"iat"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1766993470</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Issued At (timestamp)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">"exp"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1766994370</span><span class="token plain">     </span><span class="token comment" style="color:rgb(98, 114, 164)">// Expiration (timestamp)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is Base64Url encoded → <code>eyJzdWIiOiI4MjkxOWQ5Zi03...</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-signature">Part 3: Signature<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#part-3-signature" class="hash-link" aria-label="Direct link to Part 3: Signature" title="Direct link to Part 3: Signature">​</a></h3>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token constant" style="color:rgb(189, 147, 249)">HMACSHA256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">base64UrlEncode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">header</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"."</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">base64UrlEncode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">"your-super-secret-jwt-key"</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Your JWT_SECRET from .env</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This creates a signature that verifies the token wasn't tampered with.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-access-token-vs-refresh-token">2. Access Token vs Refresh Token<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#2-access-token-vs-refresh-token" class="hash-link" aria-label="Direct link to 2. Access Token vs Refresh Token" title="Direct link to 2. Access Token vs Refresh Token">​</a></h2>
<table><thead><tr><th>Feature</th><th>Access Token</th><th>Refresh Token</th></tr></thead><tbody><tr><td><strong>Purpose</strong></td><td>Authenticate API requests</td><td>Get new access tokens</td></tr><tr><td><strong>Lifespan</strong></td><td>Short (15 min - 1 hour)</td><td>Long (7 days - 30 days)</td></tr><tr><td><strong>Stored in</strong></td><td>Memory / localStorage</td><td>localStorage / httpOnly cookie</td></tr><tr><td><strong>Sent with</strong></td><td>Every API request</td><td>Only to <code>/auth/refresh</code> endpoint</td></tr><tr><td><strong>If stolen</strong></td><td>Limited damage (expires soon)</td><td>More dangerous (can get new tokens)</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-two-tokens">Why Two Tokens?<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#why-two-tokens" class="hash-link" aria-label="Direct link to Why Two Tokens?" title="Direct link to Why Two Tokens?">​</a></h3>
<p><strong>Security vs User Experience tradeoff:</strong></p>
<ol>
<li>
<p><strong>If we only had long-lived tokens:</strong></p>
<ul>
<li>User stays logged in for weeks ✅</li>
<li>But if stolen, attacker has access for weeks ❌</li>
</ul>
</li>
<li>
<p><strong>If we only had short-lived tokens:</strong></p>
<ul>
<li>If stolen, attacker only has 15 minutes ✅</li>
<li>But user must re-login every 15 minutes ❌</li>
</ul>
</li>
<li>
<p><strong>With Access + Refresh tokens:</strong></p>
<ul>
<li>Access token expires quickly (15 min) - limits damage if stolen ✅</li>
<li>Refresh token gets new access tokens - user stays logged in ✅</li>
<li>Refresh token is only sent to ONE endpoint - smaller attack surface ✅</li>
</ul>
</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-the-complete-authentication-flow">3. The Complete Authentication Flow<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#3-the-complete-authentication-flow" class="hash-link" aria-label="Direct link to 3. The Complete Authentication Flow" title="Direct link to 3. The Complete Authentication Flow">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                           AUTHENTICATION FLOW                                │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌──────────┐                    ┌──────────┐                    ┌──────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  Browser │                    │  Backend │                    │ Database │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└────┬─────┘                    └────┬─────┘                    └────┬─────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  1. POST /auth/login          │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  { email, password }          │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │──────────────────────────────&gt;│                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  2. Verify password           │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │──────────────────────────────&gt;│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │&lt;──────────────────────────────│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  3. Generate tokens:          │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │     - Access (15min)          │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │     - Refresh (7 days)        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  4. Store refresh token       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │──────────────────────────────&gt;│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │&lt;──────────────────────────────│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  5. Return both tokens        │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │&lt;──────────────────────────────│                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  6. Store in localStorage:    │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │     auth_access_token         │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │     auth_refresh_token        │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-making-authenticated-requests">4. Making Authenticated Requests<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#4-making-authenticated-requests" class="hash-link" aria-label="Direct link to 4. Making Authenticated Requests" title="Direct link to 4. Making Authenticated Requests">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌──────────┐                    ┌──────────┐                    ┌──────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  Browser │                    │  Backend │                    │ Database │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└────┬─────┘                    └────┬─────┘                    └────┬─────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  GET /api/products            │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  Header: Authorization:       │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  Bearer eyJhbGci...           │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │──────────────────────────────&gt;│                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  1. Extract token from header │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  2. Verify signature with     │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │     JWT_SECRET                │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  3. Check expiration          │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  4. Extract user info         │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  If valid:                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  ✅ Return products           │  Get products for user        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │&lt;──────────────────────────────│──────────────────────────────&gt;│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  If expired/invalid:          │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  ❌ 401 Unauthorized          │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │&lt;──────────────────────────────│                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-token-refresh-flow-when-access-token-expires">5. Token Refresh Flow (When Access Token Expires)<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#5-token-refresh-flow-when-access-token-expires" class="hash-link" aria-label="Direct link to 5. Token Refresh Flow (When Access Token Expires)" title="Direct link to 5. Token Refresh Flow (When Access Token Expires)">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌──────────┐                    ┌──────────┐                    ┌──────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  Browser │                    │  Backend │                    │ Database │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└────┬─────┘                    └────┬─────┘                    └────┬─────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  GET /api/categories          │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  Bearer: [expired token]      │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │──────────────────────────────&gt;│                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  ❌ 401 Unauthorized          │  Token expired!               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │&lt;──────────────────────────────│                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  ┌─────────────────────────┐  │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  │ Axios Interceptor       │  │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  │ catches 401, tries      │  │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  │ to refresh              │  │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  └─────────────────────────┘  │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  POST /auth/refresh           │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  { refreshToken: "eyJ..." }   │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │──────────────────────────────&gt;│                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  1. Find token in database    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │──────────────────────────────&gt;│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │&lt;──────────────────────────────│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  2. Verify not expired        │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  3. Verify JWT signature      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  4. Generate NEW tokens       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  5. Delete OLD refresh token  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │  6. Store NEW refresh token   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │──────────────────────────────&gt;│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  Return new tokens            │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │&lt;──────────────────────────────│                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  Store new tokens in          │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  localStorage                 │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  RETRY original request       │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  GET /api/categories          │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  Bearer: [NEW access token]   │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │──────────────────────────────&gt;│                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │  ✅ Return categories         │                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │&lt;──────────────────────────────│                               │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     │                               │                               │</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-how-its-implemented-in-your-codebase">6. How It's Implemented in Your Codebase<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#6-how-its-implemented-in-your-codebase" class="hash-link" aria-label="Direct link to 6. How It's Implemented in Your Codebase" title="Direct link to 6. How It's Implemented in Your Codebase">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backend-nestjs">Backend (NestJS)<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#backend-nestjs" class="hash-link" aria-label="Direct link to Backend (NestJS)" title="Direct link to Backend (NestJS)">​</a></h3>
<p><strong>1. Generating Tokens</strong> - auth.service.ts</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">generateTokens</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> payload </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sub</span><span class="token operator">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">           </span><span class="token comment" style="color:rgb(98, 114, 164)">// Subject - who this token is for</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    email</span><span class="token operator">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">email</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    username</span><span class="token operator">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">username</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    role</span><span class="token operator">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">role</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Access token - short lived (15 minutes)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> accessToken </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">jwtService</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sign</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    expiresIn</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'15m'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Refresh token - long lived (7 days)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> refreshToken </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">jwtService</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sign</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    expiresIn</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'7d'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Store refresh token in database (so we can invalidate it)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">prisma</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">refreshToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      token</span><span class="token operator">:</span><span class="token plain"> refreshToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      userId</span><span class="token operator">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      expiresAt</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">7</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">24</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">60</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">60</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> accessToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> refreshToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> expiresIn</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">900</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>2. JWT Guard</strong> - Protects routes</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// jwt-auth.guard.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token decorator at operator">@</span><span class="token decorator function" style="color:rgb(80, 250, 123)">Injectable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">JwtAuthGuard</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name">AuthGuard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'jwt'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">canActivate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">context</span><span class="token operator">:</span><span class="token plain"> ExecutionContext</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Check if route is marked @Public()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> isPublic </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">reflector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token constant" style="color:rgb(189, 147, 249)">IS_PUBLIC_KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">isPublic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Skip auth for public routes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">super</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">canActivate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Verify JWT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>3. JWT Strategy</strong> - Validates tokens</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// jwt.strategy.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token decorator at operator">@</span><span class="token decorator function" style="color:rgb(80, 250, 123)">Injectable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">JwtStrategy</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name">PassportStrategy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Strategy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">constructor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">super</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      jwtFromRequest</span><span class="token operator">:</span><span class="token plain"> ExtractJwt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">fromAuthHeaderAsBearerToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      secretOrKey</span><span class="token operator">:</span><span class="token plain"> process</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">JWT_SECRET</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Same secret used to sign</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Called after JWT is verified</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">validate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">payload</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      userId</span><span class="token operator">:</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sub</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      email</span><span class="token operator">:</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">email</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      role</span><span class="token operator">:</span><span class="token plain"> payload</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">role</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="frontend-reactnextjs">Frontend (React/Next.js)<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#frontend-reactnextjs" class="hash-link" aria-label="Direct link to Frontend (React/Next.js)" title="Direct link to Frontend (React/Next.js)">​</a></h3>
<p><strong>1. Storing Tokens After Login</strong> - authSlice.ts</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> authService</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">login</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">email</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> password</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Store both tokens in localStorage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tokenManager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setTokens</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">accessToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">refreshToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>2. Attaching Token to Every Request</strong> - axios-instance.ts</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">axiosInstance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">interceptors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">use</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> token </span><span class="token operator">=</span><span class="token plain"> tokenManager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getAccessToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">headers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Authorization </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">token</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>3. Auto-Refresh on 401</strong> - axios-instance.ts</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">axiosInstance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">interceptors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">use</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">response</span><span class="token operator">?.</span><span class="token plain">status </span><span class="token operator">===</span><span class="token plain"> </span><span class="token number">401</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">originalRequest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_retry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      originalRequest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">_retry </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> refreshToken </span><span class="token operator">=</span><span class="token plain"> tokenManager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getRefreshToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// Get new tokens</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> axios</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">post</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'/auth/refresh'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> refreshToken </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// Store new tokens</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      tokenManager</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setTokens</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">accessToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">refreshToken</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// Retry the failed request with new token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">axiosInstance</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">originalRequest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-the-relationship-diagram">7. The Relationship Diagram<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#7-the-relationship-diagram" class="hash-link" aria-label="Direct link to 7. The Relationship Diagram" title="Direct link to 7. The Relationship Diagram">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                              JWT ECOSYSTEM                                   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              ┌─────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              │   JWT_SECRET    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              │ (in .env file)  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              └────────┬────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    ┌──────────────────┼──────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │                  │                  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    ▼                  ▼                  ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           ┌────────────────┐ ┌────────────────┐ ┌────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           │  Sign Tokens   │ │ Verify Tokens  │ │ Decode Tokens  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           │  (on login)    │ │ (on requests)  │ │ (get payload)  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           └────────┬───────┘ └────────────────┘ └────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ┌───────────┴───────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ▼                       ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌───────────────┐       ┌───────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│ ACCESS TOKEN  │       │ REFRESH TOKEN │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│  (15 minutes) │       │   (7 days)    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└───────┬───────┘       └───────┬───────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        │                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        │                       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ▼                       ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌───────────────────┐   ┌───────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│    localStorage   │   │    localStorage   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│ auth_access_token │   │ auth_refresh_token│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└───────────────────┘   └─────────┬─────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                  ▼</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        ┌───────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        │     DATABASE      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        │  RefreshToken     │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        │  table (for       │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        │  invalidation)    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        └───────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│                           REQUEST LIFECYCLE                                  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  User Action          Frontend                    Backend                  DB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │  Click "Create"   │                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │──────────────────&gt;│                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │  1. Get access token     │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │     from localStorage    │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │  2. Add to header:       │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │     Authorization:       │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │     Bearer eyJ...        │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │  POST /api/categories    │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │─────────────────────────&gt;│                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │  3. JwtAuthGuard     │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │     - Extract token  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │     - Verify with    │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │       JWT_SECRET     │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │     - Check exp      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │  4. @CurrentUser()   │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │     - Get user from  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │       token payload  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │  5. Create category  │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │─────────────────────&gt;│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │&lt;─────────────────────│</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │  ✅ 201 Created          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │  Show success     │&lt;─────────────────────────│                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │&lt;──────────────────│                          │                      │</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      │                   │                          │                      │</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-security-best-practices">8. Security Best Practices<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#8-security-best-practices" class="hash-link" aria-label="Direct link to 8. Security Best Practices" title="Direct link to 8. Security Best Practices">​</a></h2>
<table><thead><tr><th>Practice</th><th>Why</th><th>Your Code</th></tr></thead><tbody><tr><td><strong>Short access token expiry</strong></td><td>Limits damage if stolen</td><td>✅ 15 minutes</td></tr><tr><td><strong>Store refresh token in DB</strong></td><td>Can invalidate on logout</td><td>✅ RefreshToken table</td></tr><tr><td><strong>Rotate refresh tokens</strong></td><td>Old tokens become invalid</td><td>✅ Delete old, create new</td></tr><tr><td><strong>Use HTTPS</strong></td><td>Prevents token interception</td><td>⚠️ Use in production</td></tr><tr><td><strong>HttpOnly cookies</strong></td><td>Prevents XSS theft</td><td>❌ Using localStorage</td></tr><tr><td><strong>Strong JWT_SECRET</strong></td><td>Prevents token forgery</td><td>⚠️ Change in production</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-common-questions">9. Common Questions<a href="https://blog.abishekn.com.np/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce#9-common-questions" class="hash-link" aria-label="Direct link to 9. Common Questions" title="Direct link to 9. Common Questions">​</a></h2>
<p><strong>Q: Why store refresh token in database?</strong>
A: So you can invalidate it on logout. Without DB storage, the token is valid until expiration.</p>
<p><strong>Q: Can I decode a JWT without the secret?</strong>
A: Yes! The payload is just Base64 encoded. But you can't <strong>verify</strong> it without the secret.</p>
<p><strong>Q: What happens if someone steals my refresh token?</strong>
A: They can get new access tokens until you logout (which deletes the refresh token from DB).</p>
<p><strong>Q: Why not just use sessions?</strong>
A: JWTs are stateless - server doesn't need to store session data. Better for scaling and microservices.</p>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Technical" term="Technical"/>
        <category label="NestJS" term="NestJS"/>
        <category label="JavaScript" term="JavaScript"/>
        <category label="Authentication" term="Authentication"/>
        <category label="JWT" term="JWT"/>
        <category label="Security" term="Security"/>
        <category label="E-Commerce" term="E-Commerce"/>
        <category label="Backend" term="Backend"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spanner - Google solution for distributed database in easier]]></title>
        <id>https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management</id>
        <link href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management"/>
        <updated>2025-12-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I explored the paper - Spanner: Google’s Globally Distributed Database. This blog contains about the spanner in easier way to those who wants to learn about it]]></summary>
        <content type="html"><![CDATA[<p><strong>Overview:</strong>
Spanner is Google's scalable, globally-distributed database that combines the benefits of traditional relational databases with massive scalability across datacenters worldwide.</p>
<p><strong>Key Features:</strong></p>
<ol>
<li>
<p><strong>Global Distribution &amp; Replication</strong></p>
<ul>
<li>Shards data across multiple datacenters globally using Paxos consensus</li>
<li>Automatic failover and resharding</li>
<li>Configurable replication (typically 3-5 replicas)</li>
</ul>
</li>
<li>
<p><strong>TrueTime API</strong></p>
<ul>
<li>Novel time API that explicitly exposes clock uncertainty</li>
<li>Uses GPS and atomic clocks for synchronization</li>
<li>Typical uncertainty (ε) is 1-7ms</li>
<li>Enables strong consistency guarantees</li>
</ul>
</li>
<li>
<p><strong>Transaction Support</strong></p>
<ul>
<li><strong>External consistency</strong> (linearizability) for distributed transactions</li>
<li>Lock-free snapshot transactions</li>
<li>Non-blocking reads in the past</li>
<li>Two-phase commit across Paxos groups</li>
</ul>
</li>
<li>
<p><strong>Data Model</strong></p>
<ul>
<li>Semi-relational tables with SQL-like query language</li>
<li>Hierarchical schema with directories as units of data placement</li>
<li>Versioned key-value storage with automatic timestamps</li>
</ul>
</li>
</ol>
<p><strong>Performance Highlights:</strong></p>
<ul>
<li>Write latency: ~15ms (including commit wait)</li>
<li>Snapshot read latency: ~1.4ms</li>
<li>Successfully handles datacenter failures with minimal disruption</li>
<li>First major customer (F1 - Google's advertising backend) migrated from sharded MySQL</li>
</ul>
<p><strong>Significance:</strong>
First system to provide external consistency and globally-consistent reads at global scale, making it suitable for applications requiring strong consistency across continents.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-the-basic-problem-spanner-solves">1. <strong>The Basic Problem Spanner Solves</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#1-the-basic-problem-spanner-solves" class="hash-link" aria-label="Direct link to 1-the-basic-problem-spanner-solves" title="Direct link to 1-the-basic-problem-spanner-solves">​</a></h2>
<p>Imagine you have a banking app used worldwide. You need:</p>
<ul>
<li><strong>Data everywhere</strong>: Users in Japan and USA both need fast access</li>
<li><strong>Consistency</strong>: If someone transfers money, both accounts must update correctly</li>
<li><strong>Availability</strong>: System must work even if a datacenter fails</li>
</ul>
<p>Traditional databases struggle with this. Spanner solves it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-core-concepts">2. <strong>Core Concepts</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#2-core-concepts" class="hash-link" aria-label="Direct link to 2-core-concepts" title="Direct link to 2-core-concepts">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-data-distribution-sharding"><strong>A. Data Distribution (Sharding)</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#a-data-distribution-sharding" class="hash-link" aria-label="Direct link to a-data-distribution-sharding" title="Direct link to a-data-distribution-sharding">​</a></h3>
<p>Think of your data like a library:</p>
<ul>
<li>Instead of one giant building (single server), you have multiple branches (servers) worldwide</li>
<li>Each branch holds certain books (data shards)</li>
<li>Users go to their nearest branch for faster service</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">User Data Split Across Servers:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server 1 (USA): Users A-M</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server 2 (Europe): Users N-Z</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server 3 (Asia): Backup copies</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="b-replication-copies"><strong>B. Replication (Copies)</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#b-replication-copies" class="hash-link" aria-label="Direct link to b-replication-copies" title="Direct link to b-replication-copies">​</a></h3>
<ul>
<li>Each piece of data exists in <strong>multiple locations</strong> (typically 3-5 copies)</li>
<li>If one datacenter fails, others keep working</li>
<li>Like having backup copies of important documents in different safe deposit boxes</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="c-paxos-consensus"><strong>C. Paxos Consensus</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#c-paxos-consensus" class="hash-link" aria-label="Direct link to c-paxos-consensus" title="Direct link to c-paxos-consensus">​</a></h3>
<p>This is how servers <strong>agree</strong> on what data is correct:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Simple Example:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. Server A wants to write "Balance = $100"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. It asks other servers: "Can I write this?"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. Majority (3 out of 5) must agree</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. Once majority agrees, write is committed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5. All servers eventually get updated</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-the-truetime-innovation">3. <strong>The TrueTime Innovation</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#3-the-truetime-innovation" class="hash-link" aria-label="Direct link to 3-the-truetime-innovation" title="Direct link to 3-the-truetime-innovation">​</a></h2>
<p>This is Spanner's "secret sauce" for handling time across the globe.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-time-problem"><strong>The Time Problem:</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#the-time-problem" class="hash-link" aria-label="Direct link to the-time-problem" title="Direct link to the-time-problem">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server in USA: "Transaction happened at 10:00:00"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server in Japan: "Transaction happened at 10:00:01"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">But which really came first? Clocks aren't perfectly synchronized!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="truetime-solution"><strong>TrueTime Solution:</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#truetime-solution" class="hash-link" aria-label="Direct link to truetime-solution" title="Direct link to truetime-solution">​</a></h3>
<p>Instead of saying "it's exactly 10:00:00", TrueTime says:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">"It's between 10:00:00.003 and 10:00:00.007"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(uncertainty range)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>How it works:</strong></p>
<ul>
<li>Uses GPS satellites and atomic clocks</li>
<li>Admits uncertainty explicitly</li>
<li>Waits out uncertainty when needed for correctness</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Example:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Transaction 1 commits at time [10:00:00.000 - 10:00:00.007]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Spanner waits until 10:00:00.007 passes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Then Transaction 2 can start at [10:00:00.008 - 10:00:00.015]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Now we KNOW Transaction 1 finished before Transaction 2 started!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-transaction-types">4. <strong>Transaction Types</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#4-transaction-types" class="hash-link" aria-label="Direct link to 4-transaction-types" title="Direct link to 4-transaction-types">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="read-write-transactions-strong-consistency"><strong>Read-Write Transactions</strong> (Strong Consistency)<a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#read-write-transactions-strong-consistency" class="hash-link" aria-label="Direct link to read-write-transactions-strong-consistency" title="Direct link to read-write-transactions-strong-consistency">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Example: Transfer $50 from Account A to Account B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. Lock both accounts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. Read current balances</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. Calculate new balances</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. Get timestamp from TrueTime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5. Write changes to multiple servers (Paxos)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">6. Wait for commit-wait (ensures ordering)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7. Release locks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="snapshot-transactions-read-only-no-locks"><strong>Snapshot Transactions</strong> (Read-Only, No Locks)<a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#snapshot-transactions-read-only-no-locks" class="hash-link" aria-label="Direct link to snapshot-transactions-read-only-no-locks" title="Direct link to snapshot-transactions-read-only-no-locks">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Example: Generate monthly report</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. Pick a timestamp in the past (e.g., "end of last month")</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. Read data as it existed at that exact time</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. No locks needed - just reading history</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. Can read from any replica that's up-to-date</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-data-organization">5. <strong>Data Organization</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#5-data-organization" class="hash-link" aria-label="Direct link to 5-data-organization" title="Direct link to 5-data-organization">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="directories"><strong>Directories</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#directories" class="hash-link" aria-label="Direct link to directories" title="Direct link to directories">​</a></h3>
<p>Think of directories as folders that keep related data together:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Directory for User "Alice":</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── Profile Info</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── Purchase History</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└── Preferences</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">This whole directory:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Stays together on same servers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Moves as a unit if needed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- Can be replicated to different locations</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-example"><strong>Schema Example</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#schema-example" class="hash-link" aria-label="Direct link to schema-example" title="Direct link to schema-example">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- Users table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> Users {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  user_id INT64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  email STRING</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name STRING</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">} </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- Orders table (nested under Users)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> Orders {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  user_id INT64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  order_id INT64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  amount </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FLOAT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">} </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> order_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  INTERLEAVE </span><span class="token operator">IN</span><span class="token plain"> PARENT Users</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>INTERLEAVE</code> means orders are stored physically close to their user - faster queries!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-how-a-write-works-step-by-step">6. <strong>How a Write Works (Step-by-Step)</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#6-how-a-write-works-step-by-step" class="hash-link" aria-label="Direct link to 6-how-a-write-works-step-by-step" title="Direct link to 6-how-a-write-works-step-by-step">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">User wants to update their email:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. REQUEST arrives at nearest Spanner server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. SERVER identifies which Paxos group owns this data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. LEADER of that group receives the request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. ACQUIRE LOCKS on the data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5. PROPOSE change to other replicas via Paxos</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   "I want to write: user_123.email = 'new@email.com'"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">6. REPLICAS vote (need majority to agree)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7. TIMESTAMP assigned using TrueTime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   timestamp = TT.now().latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">8. COMMIT WAIT - wait until TT.after(timestamp) is true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   (ensures external consistency)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">9. APPLY the change to all replicas</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10. RELEASE LOCKS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">11. RETURN success to user</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-key-benefits">7. <strong>Key Benefits</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#7-key-benefits" class="hash-link" aria-label="Direct link to 7-key-benefits" title="Direct link to 7-key-benefits">​</a></h2>
<table><thead><tr><th>Feature</th><th>What It Means</th></tr></thead><tbody><tr><td><strong>External Consistency</strong></td><td>Transactions appear in the order they actually happened in real time</td></tr><tr><td><strong>Global Availability</strong></td><td>Works even if entire datacenters fail</td></tr><tr><td><strong>SQL Support</strong></td><td>Use familiar database queries</td></tr><tr><td><strong>Automatic Scaling</strong></td><td>Add servers without downtime</td></tr><tr><td><strong>Strong Consistency</strong></td><td>No "eventual consistency" surprises</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-real-world-example-googles-f1">8. <strong>Real-World Example: Google's F1</strong><a href="https://blog.abishekn.com.np/blog/how-google-use-spanner-for-distributed-database-management#8-real-world-example-googles-f1" class="hash-link" aria-label="Direct link to 8-real-world-example-googles-f1" title="Direct link to 8-real-world-example-googles-f1">​</a></h2>
<p>Google's advertising system uses Spanner:</p>
<ul>
<li><strong>Before</strong>: Manually sharded MySQL (nightmare to manage)</li>
<li><strong>After</strong>: Spanner handles sharding automatically</li>
<li><strong>Scale</strong>: Tens of terabytes, millions of operations/second</li>
<li><strong>Replication</strong>: 5 replicas across US (2 west coast, 3 east coast)</li>
</ul>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Technical" term="Technical"/>
        <category label="Database" term="Database"/>
        <category label="Distributed Database" term="Distributed Database"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Understanding Transactions and Locking in PostgreSQL]]></title>
        <id>https://blog.abishekn.com.np/blog/postgresql-transactions-locking</id>
        <link href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking"/>
        <updated>2025-08-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[A deep dive into PostgreSQL transactions, error handling, savepoints, transactional DDLs, and locking with MVCC.]]></summary>
        <content type="html"><![CDATA[<p>This guide provides a comprehensive overview of transactions and locking mechanisms in PostgreSQL, based on provided examples and outputs. It covers transaction basics, error handling, savepoints, transactional DDLs, and basic locking with Multi-Version Concurrency Control (MVCC). The outputs from the provided examples are included to illustrate the behavior.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-contents">Table of Contents<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#table-of-contents" class="hash-link" aria-label="Direct link to Table of Contents" title="Direct link to Table of Contents">​</a></h2>
<ol>
<li><a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#working-with-postgresql-transactions">Working with PostgreSQL Transactions</a></li>
<li><a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#handling-errors-inside-a-transaction">Handling Errors Inside a Transaction</a></li>
<li><a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#using-savepoint">Using SAVEPOINT</a></li>
<li><a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#transactional-ddls">Transactional DDLs</a></li>
<li><a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#understanding-basic-locking-and-mvcc">Understanding Basic Locking and MVCC</a></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-postgresql-transactions">Working with PostgreSQL Transactions<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#working-with-postgresql-transactions" class="hash-link" aria-label="Direct link to Working with PostgreSQL Transactions" title="Direct link to Working with PostgreSQL Transactions">​</a></h2>
<p>In PostgreSQL, every operation is part of a transaction, even single statements. Transactions ensure data consistency and integrity.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-functions-for-timestamps">Key Functions for Timestamps<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#key-functions-for-timestamps" class="hash-link" aria-label="Direct link to Key Functions for Timestamps" title="Direct link to Key Functions for Timestamps">​</a></h3>
<ul>
<li>
<p><strong><code>now()</code></strong>: Returns the same timestamp for all statements within a transaction, ensuring consistency.</p>
<ul>
<li>Example: Useful for logging actions with a consistent timestamp.</li>
<li>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<!-- -->Output:<!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">           now                |               now</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------------------------------+----------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2025-08-14 13:05:37.943104+05:45 | 2025-08-14 13:05:37.943104+05:45</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Both calls to <code>now()</code> return the same timestamp within a single transaction.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong><code>clock_timestamp()</code></strong>: Returns the real-time timestamp for each call, even within the same transaction.</p>
<ul>
<li>Example: Useful for measuring query execution time.</li>
<li>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> clock_timestamp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<!-- -->Output:<!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">         clock_timestamp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2025-08-14 13:06:42.247353+05:45</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="explicit-transactions">Explicit Transactions<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#explicit-transactions" class="hash-link" aria-label="Direct link to Explicit Transactions" title="Direct link to Explicit Transactions">​</a></h3>
<p>To group multiple statements into a single transaction, use the <code>BEGIN</code>, <code>COMMIT</code>, and <code>ROLLBACK</code> commands:</p>
<ul>
<li>
<p><strong><code>BEGIN</code></strong>: Starts a transaction.</p>
</li>
<li>
<p><strong><code>COMMIT</code> or <code>END</code></strong>: Commits the transaction, making changes permanent.</p>
</li>
<li>
<p><strong><code>ROLLBACK</code> or <code>ABORT</code></strong>: Discards changes made in the transaction.</p>
</li>
<li>
<p>Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMIT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             now</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2025-08-14 13:11:50.579118+05:45</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">             now</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2025-08-14 13:11:50.579118+05:45</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Both <code>now()</code> calls return the same timestamp, as they are part of the same transaction.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="read-only-transactions">Read-Only Transactions<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#read-only-transactions" class="hash-link" aria-label="Direct link to Read-Only Transactions" title="Direct link to Read-Only Transactions">​</a></h3>
<p>Set a transaction to read-only to prevent modifications:</p>
<ul>
<li>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SHOW</span><span class="token plain"> transaction_read_only</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TRANSACTION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">READ</span><span class="token plain"> ONLY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMIT</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CHAIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SHOW</span><span class="token plain"> transaction_read_only</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMIT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> transaction_read_only</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> off</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ?column?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMIT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> transaction_read_only</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Initially, <code>transaction_read_only</code> is <code>off</code> (read/write mode).</li>
<li><code>BEGIN TRANSACTION READ ONLY</code> sets it to <code>on</code>.</li>
<li><code>COMMIT AND CHAIN</code> commits the transaction and starts a new one with the same read-only property.</li>
</ul>
</li>
</ul>
<p>To get help for commands in <code>psql</code>:</p>
<ul>
<li>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">\h </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMIT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Command:     COMMIT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Description: commit the current transaction</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Syntax:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMIT [ WORK | TRANSACTION ] [ AND [ NO ] CHAIN ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">URL: https://www.postgresql.org/docs/16/sql-commit.html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">\h </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ROLLBACK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Command:     ROLLBACK</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Description: abort the current transaction</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Syntax:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ROLLBACK [ WORK | TRANSACTION ] [ AND [ NO ] CHAIN ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">URL: https://www.postgresql.org/docs/16/sql-rollback.html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="handling-errors-inside-a-transaction">Handling Errors Inside a Transaction<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#handling-errors-inside-a-transaction" class="hash-link" aria-label="Direct link to Handling Errors Inside a Transaction" title="Direct link to Handling Errors Inside a Transaction">​</a></h2>
<p>If an error occurs within a transaction, PostgreSQL aborts the transaction, and subsequent commands are ignored until the transaction is rolled back or committed.</p>
<ul>
<li>
<p>Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMIT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ?column?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ERROR:  division by zero</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ERROR:  current transaction is aborted, commands ignored until end of transaction block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ROLLBACK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>The <code>division by zero</code> error aborts the transaction.</li>
<li>The subsequent <code>SELECT 2</code> is ignored until <code>ROLLBACK</code> resets the transaction state.</li>
<li>Use <code>ROLLBACK</code> to discard changes and recover from the error.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-savepoint">Using SAVEPOINT<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#using-savepoint" class="hash-link" aria-label="Direct link to Using SAVEPOINT" title="Direct link to Using SAVEPOINT">​</a></h2>
<p>Savepoints allow partial rollbacks within a transaction, enabling recovery from errors without discarding all changes.</p>
<ul>
<li>
<p>Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SAVEPOINT</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number">2</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ROLLBACK</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SAVEPOINT</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMIT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ?column?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SAVEPOINT</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ERROR:  division by zero</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ERROR:  current transaction is aborted, commands ignored until end of transaction block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ROLLBACK</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ?column?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ?column?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>SAVEPOINT a</code> marks a point in the transaction.</li>
<li>After the <code>division by zero</code> error, <code>ROLLBACK TO SAVEPOINT a</code> reverts to the state at <code>a</code>.</li>
<li>Subsequent commands (<code>SELECT 2</code>, <code>SELECT 3</code>) execute successfully.</li>
<li>Use <code>RELEASE SAVEPOINT &lt;name&gt;</code> to remove a savepoint if no longer needed.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="transactional-ddls">Transactional DDLs<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#transactional-ddls" class="hash-link" aria-label="Direct link to Transactional DDLs" title="Direct link to Transactional DDLs">​</a></h2>
<p>PostgreSQL supports transactional Data Definition Language (DDL) operations, meaning DDL commands (e.g., <code>CREATE TABLE</code>, <code>ALTER TABLE</code>) can be rolled back if the transaction fails.</p>
<ul>
<li>
<p>Example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> testme </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> testme </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COLUMN</span><span class="token plain"> id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TYPE</span><span class="token plain"> int8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> testme2 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> testme2 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COLUMN</span><span class="token plain"> name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TYPE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">\d testme</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">\d testme2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ROLLBACK</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">\d testme</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE TABLE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              Table "public.testme"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Column |  Type  | Collation | Nullable | Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--------+--------+-----------+----------+---------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> id     | bigint |           |          |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   Table "public.testme2"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Column |         Type          | Collation | Nullable | Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--------+-----------------------+-----------+----------+---------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> name   | character varying(50) |           |          |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ROLLBACK</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Did not find any relation named "testme".</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>The tables <code>testme</code> and <code>testme2</code> are created and modified within the transaction.</li>
<li>After <code>ROLLBACK</code>, both tables are removed, as the transaction was not committed.</li>
<li>The final <code>\d testme;</code> confirms the table no longer exists.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-basic-locking-and-mvcc">Understanding Basic Locking and MVCC<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#understanding-basic-locking-and-mvcc" class="hash-link" aria-label="Direct link to Understanding Basic Locking and MVCC" title="Direct link to Understanding Basic Locking and MVCC">​</a></h2>
<p>PostgreSQL uses <strong>Multi-Version Concurrency Control (MVCC)</strong> to handle concurrent transactions, ensuring that read operations do not block write operations and vice versa.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-concurrent-read-and-write">Example: Concurrent Read and Write<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#example-concurrent-read-and-write" class="hash-link" aria-label="Direct link to Example: Concurrent Read and Write" title="Direct link to Example: Concurrent Read and Write">​</a></h3>
<ul>
<li>
<p><strong>Transaction 1</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> testme</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UPDATE</span><span class="token plain"> testme </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> id </span><span class="token operator">=</span><span class="token plain"> id </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">RETURNING</span><span class="token plain"> </span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMIT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UPDATE 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Transaction 2</strong> (concurrent):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> testme</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMIT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Transaction 2 sees the data as it was before Transaction 1’s update (<code>id = 0</code>) due to MVCC.</li>
<li>Write transactions (e.g., <code>UPDATE</code>) do not block read transactions (e.g., <code>SELECT</code>).</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="concurrent-updates">Concurrent Updates<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#concurrent-updates" class="hash-link" aria-label="Direct link to Concurrent Updates" title="Direct link to Concurrent Updates">​</a></h3>
<p>When multiple transactions update the same table:</p>
<ul>
<li>
<p><strong>Transaction 1</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UPDATE</span><span class="token plain"> testme </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> id </span><span class="token operator">=</span><span class="token plain"> id </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">RETURNING</span><span class="token plain"> </span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UPDATE</span><span class="token plain"> testme </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> id </span><span class="token operator">=</span><span class="token plain"> id </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">RETURNING</span><span class="token plain"> </span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMIT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UPDATE 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UPDATE 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Transaction 2</strong> (after Transaction 1 commits):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UPDATE</span><span class="token plain"> testme </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SET</span><span class="token plain"> id </span><span class="token operator">=</span><span class="token plain"> id </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">RETURNING</span><span class="token plain"> </span><span class="token operator">*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">COMMIT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UPDATE 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">COMMIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Transaction 2 updates the row after Transaction 1 commits, incrementing <code>id</code> to 4.</li>
<li>PostgreSQL locks only the rows affected by an <code>UPDATE</code>, allowing concurrent updates on different rows in the same table.</li>
<li>For example, with 1,000 rows, 1,000 concurrent updates can occur on different rows without conflict.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-example">Additional Example<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#additional-example" class="hash-link" aria-label="Direct link to Additional Example" title="Direct link to Additional Example">​</a></h3>
<ul>
<li><strong>Transaction</strong>:<!-- -->
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">BEGIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> testme</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<!-- -->Output:<!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(1 row)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-notes">Additional Notes<a href="https://blog.abishekn.com.np/blog/postgresql-transactions-locking#additional-notes" class="hash-link" aria-label="Direct link to Additional Notes" title="Direct link to Additional Notes">​</a></h2>
<ul>
<li>Use <code>\h &lt;command&gt;</code> in <code>psql</code> to get help for commands like <code>SELECT</code>, <code>COMMIT</code>, or <code>ROLLBACK</code>.</li>
<li>PostgreSQL’s MVCC ensures high concurrency by maintaining multiple versions of data, allowing readers to see a consistent snapshot without waiting for writers.</li>
<li>Always commit or roll back transactions explicitly to avoid leaving connections in an aborted state.</li>
<li>The note "aba jaba, transaction 1 commit vayo, ani transaction 2 update huncha" translates to "now then, transaction 1 is committed, and transaction 2 updates" in Nepali, indicating the sequence of commits and updates.</li>
</ul>
<p>For more details, refer to the <a href="https://www.postgresql.org/docs/16/index.html" target="_blank" rel="noopener noreferrer">PostgreSQL documentation</a>.</p>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Technical" term="Technical"/>
        <category label="PostgreSQL" term="PostgreSQL"/>
        <category label="Database" term="Database"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Database Comparision between PostgreSQL, MySQL, Oracle, MS SQL Server]]></title>
        <id>https://blog.abishekn.com.np/blog/database-comparision</id>
        <link href="https://blog.abishekn.com.np/blog/database-comparision"/>
        <updated>2025-08-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I explored different database and compared with each other. I also tested PostgreSQL for its size and time for the 100000 tuples]]></summary>
        <content type="html"><![CDATA[<p>This project explores database options for small to medium-sized enterprises (SMEs), startups, and academic projects in Nepal, with a focus on building a scalable accounting system. I’ve compared popular databases and implemented an accounting system using PostgreSQL, including a Python script to generate and load 10,000 transaction records. This is tailored for contexts like ABC Warehouse, where I study, to estimate storage and performance needs.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-this-project">Why This Project?<a href="https://blog.abishekn.com.np/blog/database-comparision#why-this-project" class="hash-link" aria-label="Direct link to Why This Project?" title="Direct link to Why This Project?">​</a></h2>
<p>In Nepal, startups, colleges, and SMEs need cost-effective, scalable databases for applications like accounting systems. I’ve compared PostgreSQL, MySQL, MS SQL Server, and Oracle, and built a practical accounting system with storage estimates and performance tests. PostgreSQL is my top choice due to its power, flexibility, and zero licensing cost, perfect for Nepali use cases.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="database-comparison">Database Comparison<a href="https://blog.abishekn.com.np/blog/database-comparision#database-comparison" class="hash-link" aria-label="Direct link to Database Comparison" title="Direct link to Database Comparison">​</a></h2>
<p>Here’s a friendly breakdown of the databases I considered, with pros, cons, and use cases for Nepali users:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="postgresql">PostgreSQL<a href="https://blog.abishekn.com.np/blog/database-comparision#postgresql" class="hash-link" aria-label="Direct link to PostgreSQL" title="Direct link to PostgreSQL">​</a></h3>
<p><strong>“The modern, feature-rich open-source option — great for new, technically-savvy teams.”</strong></p>
<ul>
<li><strong>Pros</strong>:<!-- -->
<ul>
<li>No licensing cost, ideal for startups and colleges.</li>
<li>Advanced SQL features (window functions, CTEs, partitioning).</li>
<li>JSONB for flexible schemas (SQL + NoSQL).</li>
<li>PostGIS for geospatial apps (e.g., nearest hospital or delivery routing).</li>
<li>Strong concurrency with MVCC (Multi-Version Concurrency Control) for heavy read/write apps.</li>
<li>Easy to deploy on VPS or managed services (AWS RDS, DigitalOcean, Aiven).</li>
</ul>
</li>
<li><strong>Cons</strong>: Slightly steeper learning curve than MySQL for admin tasks; less common in some regulated industries (e.g., finance/healthcare).</li>
<li><strong>Use When</strong>: You want power without cost, especially for modern web apps, analytics, or geospatial projects.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mysql-community">MySQL (Community)<a href="https://blog.abishekn.com.np/blog/database-comparision#mysql-community" class="hash-link" aria-label="Direct link to MySQL (Community)" title="Direct link to MySQL (Community)">​</a></h3>
<p><strong>“Simple, common, and cheap — great for small or legacy web apps.”</strong></p>
<ul>
<li><strong>Pros</strong>: Easy to find cheap hosting; widely used in PHP-based apps (LAMP stack).</li>
<li><strong>Cons</strong>: Fewer advanced features compared to PostgreSQL or Oracle; often limited to simpler or legacy systems.</li>
<li><strong>Use When</strong>: You’re on shared hosting or building simple PHP-based apps with minimal cost.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ms-sql-server">MS SQL Server<a href="https://blog.abishekn.com.np/blog/database-comparision#ms-sql-server" class="hash-link" aria-label="Direct link to MS SQL Server" title="Direct link to MS SQL Server">​</a></h3>
<p><strong>“The comfortable, enterprise choice for Windows/.NET shops.”</strong></p>
<ul>
<li><strong>Pros</strong>: Easy to learn, great GUI tools (SSMS), automation-friendly, common in business settings.</li>
<li><strong>Cons</strong>: Expensive licensing for large deployments (Express edition is free for small projects); often tied to Windows Server costs.</li>
<li><strong>Use When</strong>: Your organization uses the Microsoft stack or needs fast onboarding for DBAs.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oracle">Oracle<a href="https://blog.abishekn.com.np/blog/database-comparision#oracle" class="hash-link" aria-label="Direct link to Oracle" title="Direct link to Oracle">​</a></h3>
<p><strong>“The power tool — huge feature set and top pay, but steep learning and cost.”</strong></p>
<ul>
<li><strong>Pros</strong>: Extremely powerful for large, mission-critical systems; top-tier enterprise features.</li>
<li><strong>Cons</strong>: Expensive and complex licensing; steep learning curve; often requires dedicated DBAs.</li>
<li><strong>Use When</strong>: Large enterprises (banks, telecoms, ERP systems) with big budgets and existing Oracle setups.</li>
</ul>
<p><strong>Recommendation for Nepali Context</strong>: I recommend <strong>PostgreSQL</strong> for most startups, colleges, and SMEs due to its power, flexibility, and no licensing cost. Use MySQL for cheap hosting or legacy PHP apps, MS SQL Server for Microsoft-heavy environments, and Oracle only for large enterprise needs.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="accounting-system-database-design">Accounting System Database Design<a href="https://blog.abishekn.com.np/blog/database-comparision#accounting-system-database-design" class="hash-link" aria-label="Direct link to Accounting System Database Design" title="Direct link to Accounting System Database Design">​</a></h2>
<p>I designed a simple accounting system for a college like ABC Warehouse, focusing on scalability and performance. The system tracks <strong>transactions</strong>, <strong>students</strong>, <strong>invoices</strong>, and <strong>invoice line items</strong>. Below is the schema and storage estimation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="schema-overview">Schema Overview<a href="https://blog.abishekn.com.np/blog/database-comparision#schema-overview" class="hash-link" aria-label="Direct link to Schema Overview" title="Direct link to Schema Overview">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="transactions-table">Transactions Table<a href="https://blog.abishekn.com.np/blog/database-comparision#transactions-table" class="hash-link" aria-label="Direct link to Transactions Table" title="Direct link to Transactions Table">​</a></h4>
<p>Stores journal entries for accounting (e.g., date, particulars, credit, debit).</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">transactions</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SERIAL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    particulars </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">200</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    credit </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">NUMERIC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    debit </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">NUMERIC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    created_at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CURRENT_TIMESTAMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    updated_at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CURRENT_TIMESTAMP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="students-table">Students Table<a href="https://blog.abishekn.com.np/blog/database-comparision#students-table" class="hash-link" aria-label="Direct link to Students Table" title="Direct link to Students Table">​</a></h4>
<p>Stores student information for invoicing.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> students </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    student_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SERIAL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    email </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    phone </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">15</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    created_at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CURRENT_TIMESTAMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    updated_at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CURRENT_TIMESTAMP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="invoices-table">Invoices Table<a href="https://blog.abishekn.com.np/blog/database-comparision#invoices-table" class="hash-link" aria-label="Direct link to Invoices Table" title="Direct link to Invoices Table">​</a></h4>
<p>Tracks invoices issued to students.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> invoices </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invoice_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SERIAL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    student_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">REFERENCES</span><span class="token plain"> students</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">student_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    issue_date </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    due_date </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DATE</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    total_amount </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">NUMERIC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    paid_amount </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">NUMERIC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    balance_due </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">NUMERIC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> GENERATED ALWAYS </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">total_amount </span><span class="token operator">-</span><span class="token plain"> paid_amount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> STORED</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    created_at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CURRENT_TIMESTAMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    updated_at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CURRENT_TIMESTAMP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="invoice-line-items-table">Invoice Line Items Table<a href="https://blog.abishekn.com.np/blog/database-comparision#invoice-line-items-table" class="hash-link" aria-label="Direct link to Invoice Line Items Table" title="Direct link to Invoice Line Items Table">​</a></h4>
<p>Details items in each invoice (e.g., tuition fees, lab fees).</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TABLE</span><span class="token plain"> invoice_line_items </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    line_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SERIAL</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    invoice_id </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">REFERENCES</span><span class="token plain"> invoices</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">invoice_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    item_name </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    description </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    quantity </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    unit_price </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">NUMERIC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    amount </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">NUMERIC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> GENERATED ALWAYS </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">quantity </span><span class="token operator">*</span><span class="token plain"> unit_price</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> STORED</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    created_at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CURRENT_TIMESTAMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    updated_at </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CURRENT_TIMESTAMP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="storage-estimation">Storage Estimation<a href="https://blog.abishekn.com.np/blog/database-comparision#storage-estimation" class="hash-link" aria-label="Direct link to Storage Estimation" title="Direct link to Storage Estimation">​</a></h3>
<p>I estimated storage needs for the accounting system based on <strong>10 transactions/day</strong>, <strong>10 students/day</strong>, and <strong>10 invoices/day</strong> with <strong>3 line items per invoice</strong>. Here’s the breakdown:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="transactions-table-1">Transactions Table<a href="https://blog.abishekn.com.np/blog/database-comparision#transactions-table-1" class="hash-link" aria-label="Direct link to Transactions Table" title="Direct link to Transactions Table">​</a></h4>
<ul>
<li><strong>Fields</strong>: id (4 bytes), date (4 bytes), particulars (200 bytes), credit (8 bytes), debit (8 bytes), created_at (8 bytes), updated_at (8 bytes).</li>
<li><strong>Total per row</strong>: 236 bytes + 27 bytes (PostgreSQL overhead) ≈ <strong>263 bytes</strong>.</li>
<li><strong>Daily</strong>: 10 transactions × 263 bytes = <strong>2.57 KB</strong>.</li>
<li><strong>Monthly</strong>: 30 days × 2.57 KB ≈ <strong>77.1 KB</strong>.</li>
<li><strong>Yearly</strong>: 360 days × 2.57 KB ≈ <strong>925 KB</strong>.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="students-table-1">Students Table<a href="https://blog.abishekn.com.np/blog/database-comparision#students-table-1" class="hash-link" aria-label="Direct link to Students Table" title="Direct link to Students Table">​</a></h4>
<ul>
<li><strong>Fields</strong>: student_id (4 bytes), name (100 bytes), email (50 bytes), phone (15 bytes), created_at (8 bytes), updated_at (8 bytes).</li>
<li><strong>Total per row</strong>: 185 bytes + 27 bytes (overhead) ≈ <strong>212 bytes</strong>.</li>
<li><strong>Daily</strong>: 10 students × 212 bytes ≈ <strong>2.07 KB</strong>.</li>
<li><strong>Monthly</strong>: 30 days × 2.07 KB ≈ <strong>62.1 KB</strong>.</li>
<li><strong>Yearly</strong>: 360 days × 2.07 KB ≈ <strong>746 KB</strong>.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="invoices-table-1">Invoices Table<a href="https://blog.abishekn.com.np/blog/database-comparision#invoices-table-1" class="hash-link" aria-label="Direct link to Invoices Table" title="Direct link to Invoices Table">​</a></h4>
<ul>
<li><strong>Fields</strong>: invoice_id (4 bytes), student_id (4 bytes), issue_date (4 bytes), due_date (4 bytes), total_amount (8 bytes), paid_amount (8 bytes), balance_due (8 bytes), status (20 bytes), created_at (8 bytes), updated_at (8 bytes).</li>
<li><strong>Total per row</strong>: 76 bytes + 23 bytes (overhead) ≈ <strong>99 bytes</strong>.</li>
<li><strong>Daily</strong>: 10 invoices × 99 bytes ≈ <strong>0.97 KB</strong>.</li>
<li><strong>Monthly</strong>: 30 days × 0.97 KB ≈ <strong>29.1 KB</strong>.</li>
<li><strong>Yearly</strong>: 360 days × 0.97 KB ≈ <strong>349 KB</strong>.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="invoice-line-items-table-1">Invoice Line Items Table<a href="https://blog.abishekn.com.np/blog/database-comparision#invoice-line-items-table-1" class="hash-link" aria-label="Direct link to Invoice Line Items Table" title="Direct link to Invoice Line Items Table">​</a></h4>
<ul>
<li><strong>Fields</strong>: line_id (4 bytes), invoice_id (4 bytes), item_name (50 bytes), description (200 bytes), quantity (4 bytes), unit_price (8 bytes), amount (8 bytes), created_at (8 bytes), updated_at (8 bytes).</li>
<li><strong>Total per row</strong>: 294 bytes + 27 bytes (overhead) ≈ <strong>321 bytes</strong>.</li>
<li><strong>Daily</strong>: 10 invoices × 3 line items × 321 bytes ≈ <strong>9.4 KB</strong>.</li>
<li><strong>Monthly</strong>: 30 days × 9.4 KB ≈ <strong>282 KB</strong>.</li>
<li><strong>Yearly</strong>: 360 days × 9.4 KB ≈ <strong>3.38 MB</strong>.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="total-storage">Total Storage<a href="https://blog.abishekn.com.np/blog/database-comparision#total-storage" class="hash-link" aria-label="Direct link to Total Storage" title="Direct link to Total Storage">​</a></h4>
<ul>
<li><strong>Daily</strong>: 2.57 KB (transactions) + 2.07 KB (students) + 0.97 KB (invoices) + 9.4 KB (line items) ≈ <strong>12.44 KB/day</strong>.</li>
<li><strong>Monthly</strong>: 12.44 KB × 30 ≈ <strong>373 KB/month</strong>.</li>
<li><strong>Yearly</strong>: 12.44 KB × 360 ≈ <strong>4.48 MB/year</strong>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scalability-notes">Scalability Notes<a href="https://blog.abishekn.com.np/blog/database-comparision#scalability-notes" class="hash-link" aria-label="Direct link to Scalability Notes" title="Direct link to Scalability Notes">​</a></h3>
<ul>
<li><strong>PostgreSQL’s MVCC</strong>: Handles high concurrency without locking, ideal for heavy read/write workloads (e.g., frequent transactions at a college).</li>
<li><strong>Storage Growth</strong>: Even with 360 transactions/year, the database size remains small (~4.48 MB/year), easily manageable on a VPS or managed service.</li>
<li><strong>Performance</strong>: Importing 100,000 transactions took ~204 ms, showing PostgreSQL’s efficiency for moderate workloads.</li>
<li><strong>Balance Sheet Queries</strong>: Use SQL aggregates (e.g., <code>SUM(credit)</code>, <code>SUM(debit)</code>) to generate balance sheets or trial balances.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="generating-and-loading-data-with-python">Generating and Loading Data with Python<a href="https://blog.abishekn.com.np/blog/database-comparision#generating-and-loading-data-with-python" class="hash-link" aria-label="Direct link to Generating and Loading Data with Python" title="Direct link to Generating and Loading Data with Python">​</a></h2>
<p>To test the system’s performance, I wrote a Python script to generate 10,000 transaction records and load them into the <code>transactions</code> table. The script creates a tab-delimited CSV file (<code>transactions.txt</code>) and uses PostgreSQL’s <code>\copy</code> command to import the data efficiently.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="python-script-for-data-generation">Python Script for Data Generation<a href="https://blog.abishekn.com.np/blog/database-comparision#python-script-for-data-generation" class="hash-link" aria-label="Direct link to Python Script for Data Generation" title="Direct link to Python Script for Data Generation">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> csv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> random</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Generate 10,000 transaction records</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">num_records </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">10000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">start_date </span><span class="token operator">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2025</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">particulars_list </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"Tuition Fee"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Lab Fee"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Library Fee"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Exam Fee"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"Miscellaneous"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">with</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'/tmp/transactions.txt'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'w'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> newline</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">''</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    writer </span><span class="token operator">=</span><span class="token plain"> csv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">writer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> delimiter</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">'\t'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    writer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">writerow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">'date'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'particulars'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'credit'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'debit'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># CSV header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">num_records</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        date </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start_date </span><span class="token operator">+</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">days</span><span class="token operator">=</span><span class="token plain">random</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">randint</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">365</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">strftime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'%Y-%m-%d'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        particulars </span><span class="token operator">=</span><span class="token plain"> random</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">particulars_list</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        credit </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">round</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">random</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uniform</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> random</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">0.5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        debit </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">round</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">random</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">uniform</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">5000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> credit </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        writer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">writerow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> particulars</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> credit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> debit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"Generated </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">num_records</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)"> transaction records in /tmp/transactions.txt"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="loading-data-into-postgresql">Loading Data into PostgreSQL<a href="https://blog.abishekn.com.np/blog/database-comparision#loading-data-into-postgresql" class="hash-link" aria-label="Direct link to Loading Data into PostgreSQL" title="Direct link to Loading Data into PostgreSQL">​</a></h3>
<p>I ran into some permission issues when trying to load the data initially (e.g., <code>Permission denied</code> for <code>/home/virtualabishek/Desktop/code/learning/postgres-notes/transactions.txt</code>). To fix this, I moved the file to <code>/tmp/</code> and used the <code>\copy</code> command, which is client-side and avoids server permission issues:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">\copy </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">transactions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> particulars</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> credit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> debit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'/tmp/transactions.txt'</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DELIMITER</span><span class="token plain"> E</span><span class="token string" style="color:rgb(255, 121, 198)">'\t'</span><span class="token plain"> CSV HEADER</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This successfully loaded 100,000 records (I tested with a larger dataset to stress-test), taking ~204 ms, as shown in my terminal output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">COPY 100000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Time: 204.345 ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lessons-learned">Lessons Learned<a href="https://blog.abishekn.com.np/blog/database-comparision#lessons-learned" class="hash-link" aria-label="Direct link to Lessons Learned" title="Direct link to Lessons Learned">​</a></h3>
<ul>
<li><strong>COPY vs. \copy</strong>: I initially tried <code>COPY</code>, but got a <code>Permission denied</code> error because it runs server-side. Switching to <code>\copy</code> resolved this.</li>
<li><strong>File Permissions</strong>: Moving the file to <code>/tmp/</code> avoided permission issues, as <code>/tmp/</code> is accessible to the PostgreSQL client.</li>
<li><strong>Performance</strong>: Loading 100,000 records in ~204 ms shows PostgreSQL’s efficiency for bulk imports.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-postgresql-for-this-project">Why PostgreSQL for This Project?<a href="https://blog.abishekn.com.np/blog/database-comparision#why-postgresql-for-this-project" class="hash-link" aria-label="Direct link to Why PostgreSQL for This Project?" title="Direct link to Why PostgreSQL for This Project?">​</a></h2>
<p>I chose PostgreSQL because:</p>
<ul>
<li><strong>No License Cost</strong>: Perfect for budget-conscious Nepali startups and colleges.</li>
<li><strong>Rich Data Types</strong>: Supports JSONB for flexible schemas, GEOMETRY for geospatial queries (e.g., campus mapping), and NUMERIC for precise accounting.</li>
<li><strong>Concurrency</strong>: MVCC ensures readers and writers don’t block each other, ideal for busy systems.</li>
<li><strong>Extensibility</strong>: PostGIS for geospatial apps, full-text search, and more.</li>
<li><strong>Deployment</strong>: Easy to run on a VPS or use managed providers (AWS RDS, Aiven).</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-instructions">Setup Instructions<a href="https://blog.abishekn.com.np/blog/database-comparision#setup-instructions" class="hash-link" aria-label="Direct link to Setup Instructions" title="Direct link to Setup Instructions">​</a></h2>
<ol>
<li>
<p><strong>Install PostgreSQL</strong>:</p>
<ul>
<li>On Ubuntu: <code>sudo apt update &amp;&amp; sudo apt install postgresql postgresql-contrib</code></li>
<li>Verify: <code>psql --version</code></li>
</ul>
</li>
<li>
<p><strong>Create Database</strong>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-u</span><span class="token plain"> postgres createdb accountdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Set Up Tables</strong>:</p>
<ul>
<li>Connect: <code>psql -d accountdb</code></li>
<li>Run the <code>CREATE TABLE</code> statements above for <code>transactions</code>, <code>students</code>, <code>invoices</code>, and <code>invoice_line_items</code>.</li>
</ul>
</li>
<li>
<p><strong>Generate Data</strong>:</p>
<ul>
<li>Run the Python script above to create <code>/tmp/transactions.txt</code> with 10,000 records.</li>
</ul>
</li>
<li>
<p><strong>Import Data</strong>:</p>
<ul>
<li>Import:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">psql </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-d</span><span class="token plain"> accountdb </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-c</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"</span><span class="token string entity" style="color:rgb(255, 121, 198)">\c</span><span class="token string" style="color:rgb(255, 121, 198)">opy transactions(date, particulars, credit, debit) FROM '/tmp/transactions.txt' DELIMITER E'</span><span class="token string entity" style="color:rgb(255, 121, 198)">\t</span><span class="token string" style="color:rgb(255, 121, 198)">' CSV HEADER"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
</li>
<li>
<p><strong>Check Database Size</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> pg_size_pretty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pg_database_size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">current_database</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>My test showed ~18 MB for the database with 100,000 transaction records.</p>
</li>
<li>
<p><strong>Monitor Performance</strong>:</p>
<ul>
<li>Enable timing: <code>\timing on</code></li>
<li>Run imports or queries to measure execution time (e.g., ~204 ms for 100,000 records).</li>
</ul>
</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-queries">Example Queries<a href="https://blog.abishekn.com.np/blog/database-comparision#example-queries" class="hash-link" aria-label="Direct link to Example Queries" title="Direct link to Example Queries">​</a></h2>
<ul>
<li>
<p><strong>List Transactions</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">transactions</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Calculate Balance Sheet</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">credit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> total_credit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">SUM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">debit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> total_debit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">transactions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">date</span><span class="token plain"> </span><span class="token operator">BETWEEN</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2025-01-01'</span><span class="token plain"> </span><span class="token operator">AND</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'2025-12-31'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Find Unpaid Invoices</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">invoice_id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">total_amount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">balance_due</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> invoices i</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">JOIN</span><span class="token plain"> students s </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">student_id </span><span class="token operator">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">student_id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">status</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'UNPAID'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-improvements">Future Improvements<a href="https://blog.abishekn.com.np/blog/database-comparision#future-improvements" class="hash-link" aria-label="Direct link to Future Improvements" title="Direct link to Future Improvements">​</a></h2>
<ul>
<li>Add indexes on frequently queried columns (e.g., <code>date</code>, <code>student_id</code>) for faster searches.</li>
<li>Implement triggers to auto-update <code>updated_at</code> timestamps.</li>
<li>Use JSONB for flexible transaction metadata (e.g., store tax info).</li>
<li>Explore PostGIS for campus-related geospatial queries (e.g., mapping student locations).</li>
<li>Optimize the Python script to generate larger datasets or simulate realistic transaction patterns.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="final-note">Final Note<a href="https://blog.abishekn.com.np/blog/database-comparision#final-note" class="hash-link" aria-label="Direct link to Final Note" title="Direct link to Final Note">​</a></h2>
<p>I built this accounting system to be lightweight (4.48 MB/year for 10 transactions/day), scalable, and cost-effective using PostgreSQL. The Python script made it easy to generate and load 10,000 records, and PostgreSQL’s performance (~204 ms for 100,000 records) proves it’s ready for real-world use. Let’s keep building awesome tech for Nepal!</p>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Technical" term="Technical"/>
        <category label="Linux" term="Linux"/>
        <category label="Development" term="Development"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Village Realities: A Four-Day Revelation]]></title>
        <id>https://blog.abishekn.com.np/blog/village-realities-four-day-revelation</id>
        <link href="https://blog.abishekn.com.np/blog/village-realities-four-day-revelation"/>
        <updated>2025-07-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Reflections from a four-day tour to rural Nepal - discovering the challenges and wisdom of village life through conversations with locals.]]></summary>
        <content type="html"><![CDATA[<p>Okay, so here's the real talk: I always imagined villages as disciplined, polite, and honest places. But after a four-day tour to a rural area of Nepal, I've come to realize that villages can actually be more challenging than urban areas. It was quite a shock; everyone seemed to be comparing themselves to each other and constantly getting into conflicts. I stayed in more than six different houses, and almost every single one had some kind of underlying problem.</p>
<p>Let me share some profound truths I learned from an 82-year-old man:</p>
<blockquote>
<ul>
<li><strong>Manage your expectations and always act with good behavior.</strong> (This is something I already knew, but it was a powerful reminder.)</li>
<li><strong>God always provides a way.</strong> If you face a problem in one area, a solution will emerge in another. For instance, if someone lacks sight, their other senses become incredibly sharp.</li>
<li><strong>Steer clear of political parties.</strong> They're often just trouble. Just vote for who you believe in.</li>
<li><strong>Choose your companions wisely.</strong> Always surround yourself with good people, even if it means being alone sometimes.</li>
<li><strong>Never pursue love or marriage based solely on phone interactions.</strong> It's often an illusion; the real world is entirely different.</li>
<li><strong>Your mother is paramount.</strong> She carried you for nine months, enduring so much, and then showed you the world. Cherish her.</li>
<li>He also taught me a lot about <strong>Karma</strong>.</li>
</ul>
</blockquote>
<hr>
<h1>Tech Wisdom from a Nonagenarian</h1>
<p>Perhaps the most fascinating encounter was with an 85-year-old man who knew an incredible amount about computers – almost as much as a computer science student! He shared insights into computer evolution and even knew <strong>QBASIC</strong>, a language that's practically ancient now. He explained different types of printers and emphasized that to truly understand technology, "you have to know everything about everything. You should know instructions and all."</p>
<p>He also gave me valuable advice on how to approach answers, especially in exams. He stressed the importance of incorporating <strong>modern trends</strong> to show the examiner you're well-read. For example, if you're writing about computer viruses, you should include examples of current virus names. He also touched upon versioning, explaining how different versions of software like Word or Excel (e.g., 2016) can complicate things. He gave a relatable example: we were taught what PowerPoint is and how it works, but we were rarely shown any practical demonstrations.</p>
<p>This led to his core message: <strong>"Practical is the way. Just focus on practical rather than theory."</strong> I completely agree with him on this. Thank you, Buwa, for these invaluable lessons.</p>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Non Technical" term="Non Technical"/>
        <category label="Life" term="Life"/>
        <category label="Travel" term="Travel"/>
        <category label="Nepal" term="Nepal"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[From Chaos to Clarity]]></title>
        <id>https://blog.abishekn.com.np/blog/breaking-down-the-problem</id>
        <link href="https://blog.abishekn.com.np/blog/breaking-down-the-problem"/>
        <updated>2025-04-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[A raw, honest dive into building a PHP portal from scratch, grappling with a new tech stack, and learning to embrace the mess of coding.]]></summary>
        <content type="html"><![CDATA[<p>Lately, I’ve been working on a project I never thought would see the light of day. The tech stack was completely different from anything I’d tackled before. I built a portal using PHP, with the entire UI crafted in HTML. Coming from a Node.js background, I was out of my comfort zone, unsure of what to do and what to avoid. I promised myself I wouldn’t be that developer who sticks to just one tech stack—especially in today’s world, where AI makes it possible for anyone to create almost anything. Still, the process wasn’t easy. I wrestled with a ton of PHP libraries—installing, importing, and figuring out how to use them.</p>
<p>For the PHP backend, I went old-school. I handled routing with a switch statement, manually creating all the routes and APIs from scratch. Where I really struggled was the file structure. In my Node.js projects, I prided myself on clean, organized files. But with this project? Total chaos. Making the UI dynamic added another layer of confusion. I was second-guessing every decision, unsure of what would work.</p>
<p>I finished the project about a month ago, and to my surprise, I recently spoke with the stakeholders, and they want to deploy it. I was shocked. I know the portal works, but I’m not fully confident in the UI or some other parts. If I’d used React with something like Shadcn, I’d feel much better about it. But they saw the demo, liked it, and are ready to move forward. I was floored—part of me was like, “What the heck?” What if I need to add more features? What if it’s deployed and I can’t make changes easily? What if the project grows and becomes too complex?</p>
<p>After some back-and-forth, I convinced them that this is the version for now, and they agreed. Once my board exams are over, I plan to revisit and improve it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-ive-learned">What I’ve Learned<a href="https://blog.abishekn.com.np/blog/breaking-down-the-problem#what-ive-learned" class="hash-link" aria-label="Direct link to What I’ve Learned" title="Direct link to What I’ve Learned">​</a></h2>
<p>Looking back, I realize I just needed to rant a bit. But here’s the bigger picture: coding, at its core, is about breaking problems into smaller, manageable steps. With AI and modern tools, that’s more true than ever. If you can take one big problem and split it into ten smaller ones—and truly understand what your code is doing—you can build anything. The tools or tech stack? They’re secondary. What matters is understanding the ecosystem and how it all fits together.</p>
<p>I’ve been crazy busy lately, juggling board exam prep and multiple projects, but I’m enjoying the process. It’s messy, it’s challenging, but it’s also rewarding. I’ll probably write another update after my exams. For now, this is just me reflecting on the journey.</p>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Technical" term="Technical"/>
        <category label="Development" term="Development"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Everyday Reflections: Life's Unexpected Moments]]></title>
        <id>https://blog.abishekn.com.np/blog/everyday-reflections</id>
        <link href="https://blog.abishekn.com.np/blog/everyday-reflections"/>
        <updated>2025-04-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Personal reflections on everyday struggles in Nepal from the lens of a non-political observer.]]></summary>
        <content type="html"><![CDATA[<p>Hey everyone, I just want to share some random thoughts today. Here in Nepal, people who aren’t interested in politicians, parties, or all that drama seem to suffer the most. I’ve had so many experiences—some made me feel terrible, others were good. Everything that’s happened to me, I always thought it’d leave a positive mark, teaching me lessons along the way.</p>
<p>There’s a lot swirling in my head right now. Honestly, people who went abroad right after +2 wouldn’t get what I’m talking about. I think those who left after their bachelor’s might understand more—they’ve probably seen more than I have.</p>
<p>I see quarrels everywhere here. Me, I’ve never been the type to fight or argue. Even when I’m not wrong, I end up saying sorry just to keep the peace. Sometimes, being too polite or asking simple questions makes you feel bad. Take today, for example—I was in Kathmandu for WordCamp 2025. I stopped at a local cafe and ordered a cup of tea. I didn’t have small change, so I handed the guy a 500-rupee note. He said he didn’t have change, which was fine—I get it, maybe I was the first customer of the day. So I asked if there was a QR code to pay digitally. He said no, and I was shocked. I went to a nearby shop, bought something I didn’t even need just to break the 500, and came back to pay. Then he goes, “Why should I get a QR code for this? If it was something like rice or a big meal, I’d understand.” Bro, who comes to your shop at 6 a.m. to eat a heavy meal? So yeah, that’s just one little thing from today.</p>
<p>I’ve been through a lot and forgotten even more. Public transport here? Don’t get me started. I’ve had so many bad experiences. Whenever I travel to Kathmandu, back to Chitwan, or anywhere else, it’s always a mess. I ask for a specific seat when I buy my ticket, and they tell me it’s full, shoving me to the back. Later, I find out it wasn’t full—they just wanted to pack the back seats first. The fares? I’ve been cheated so many times. They charge whatever they feel like. Once, they owed me 300 rupees in change—it was even written on the ticket—but they argued with me and refused to pay. During festivals, not even on the main day of Dashain, but toward the end, they double the fare. Where do I complain? How do I fix this? I just end up letting it go.</p>
<p>And education? It’s a disaster. I study at Tribhuvan University (TU), Institute of Science and Technology. I’ve switched between two government colleges. I’m not into politics or parties—you probably know how things work there if you’re not involved. The education system is a total waste, at least from my perspective. TU and its government colleges feel like a cheap certificate factory. You’re on your own—your browser tabs are your real teachers. I’m not blaming the teachers; it’s the system. Getting anything done takes forever—long processes for even the smallest service.</p>
<p>I’m exhausted, honestly. Still, I’m hoping for the best.</p>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Betryed" term="Betryed"/>
        <category label="Non Technical" term="Non Technical"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[My Linux Journey and the Power of WSL]]></title>
        <id>https://blog.abishekn.com.np/blog/linux-and-wsl-journeys</id>
        <link href="https://blog.abishekn.com.np/blog/linux-and-wsl-journeys"/>
        <updated>2025-04-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Exploring Linux, distro-hopping, and how WSL changed my development workflow.]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="https://blog.abishekn.com.np/blog/linux-and-wsl-journeys#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>If you’ve ever wondered about dipping your toes into Linux without leaving the comfort of Windows, you’re in good company. I’m not experienced one but someone who’s explored operating systems with curiosity and a bit of trial-and-error.
In this post, I’ll walk you through my Linux journey, from my early experiments to finding Windows Subsystem for Linux (WSL). It’s been quite a ride, and I hope sharing it sparks something for you.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="my-story-with-linux-and-wsl">My Story with Linux and WSL<a href="https://blog.abishekn.com.np/blog/linux-and-wsl-journeys#my-story-with-linux-and-wsl" class="hash-link" aria-label="Direct link to My Story with Linux and WSL" title="Direct link to My Story with Linux and WSL">​</a></h2>
<p>For anyone new to the term, <strong>Windows Subsystem for Linux (WSL)</strong> is a feature that lets you run a Linux environment right on your Windows machine. No need for a separate virtual machine or dual-boot setup—it’s a seamless way to blend the best of both worlds, especially for developers.</p>
<p>My Linux adventure kicked off years ago, thanks to my brother <strong>Acyut Dai</strong>, who first showed me the ropes. I was hooked right away, even if I didn’t fully grasp the technical side back then. One memory stands out: I went to a shop to buy a laptop and asked for <strong>Linux Mint</strong> instead of Windows. The salesperson was caught off guard—probably not a request he got every day. That was my launchpad into the Linux world.</p>
<p>With <strong>Linux Mint</strong> on my laptop, I dove in, exploring its features for hours. Truth be told, I didn’t have a strong grip on the basics. Over time, I bounced between <strong>12 to 15 different Linux distributions</strong>, chasing the next shiny thing without really mastering any of them. Looking back, I was more caught up in the excitement than in laying a solid groundwork.</p>
<p>Fast forward a bit, and I got access to Windows developer features, which led me to <strong>WSL</strong>. It was a total game-changer. Suddenly, I felt more productive, blending Linux tools into my Windows routine effortlessly. I think Windows saw how much developers were leaning toward Linux and built WSL to meet that need. It’s pretty powerful—think installing packages with a quick <code>sudo apt install</code> instead of wrestling with Windows-specific headaches.</p>
<p>I’ve never fully clicked with Windows’ own command-line tools, though that’s probably on me for not digging deeper. Windows is great for tons of people; WSL just smooths out certain tasks for me.</p>
<p>WSL has made a huge impact for developers globally, though it’s not a must-have for everyone—it’s all about what works for you. As a newbie blogger, I’m just here to share my take. <strong>Here’s what I’ve loved about WSL:</strong></p>
<ul>
<li><strong>Command-Line Power</strong>: It rekindled my appreciation for the command line—super efficient and flexible.</li>
<li><strong>Easy Setup</strong>: Installing languages and packages is a breeze, cutting down on setup time.</li>
<li><strong>Storage Smarts</strong>: From what I’ve seen, WSL handles storage for code and modules pretty efficiently compared to a full Linux setup (though your mileage might vary).</li>
</ul>
<p>There’s tons more to dig into, and I’d love to hear what you think about WSL if you’ve tried it!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://blog.abishekn.com.np/blog/linux-and-wsl-journeys#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>Looking back, WSL has become a key part of my development toolkit. It ties Windows and Linux together, letting me tap into both without the chaos of my distro-hopping phase. My Linux days taught me to <strong>stay focused while learning</strong>, and WSL keeps me grounded.</p>
<p>If you haven’t checked it out yet, <strong>give it a whirl!</strong> Already a user? I’d love your thoughts. Thanks for reading my first post—more to come!</p>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Technical" term="Technical"/>
        <category label="Linux" term="Linux"/>
        <category label="WSL" term="WSL"/>
        <category label="Windows" term="Windows"/>
        <category label="Development" term="Development"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Too Much Philosophy, Not Enough Presence]]></title>
        <id>https://blog.abishekn.com.np/blog/too-much-philosophy</id>
        <link href="https://blog.abishekn.com.np/blog/too-much-philosophy"/>
        <updated>2025-04-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[A reflection on the balance between thinking and truly living.]]></summary>
        <content type="html"><![CDATA[<p>Recently, I stumbled across a post on X that really hit me.</p>
<blockquote class="twitter-tweet"><p lang="zxx" dir="ltr"><a href="https://t.co/28bsnyYSZK">pic.twitter.com/28bsnyYSZK</a></p><p>— ★ (@thematrixwizard)<!-- --> </p><a href="https://twitter.com/thematrixwizard/status/1898988630967800312?ref_src=twsrc%5Etfw"><p>March 10, 2025</p></a></blockquote>
<!-- -->
<p>The caption was simple: <strong>"Too much philosophy, not enough presence."</strong> And honestly, it felt so true. We spend so much of our lives chasing positivity—trying to do good, be good, and hope only the best comes our way. But life doesn’t always play along, does it?</p>
<p>A while back, I wrote something that ties into this. It went like this:</p>
<blockquote>
<p>"These days, the internet is full of inspirational sayings, movies, and postings. However, what matters most is how much you use them in your life, regardless of how much you read or watch. Nothing is permanent, not even your beliefs, driving forces, or favorite quotations. Maybe you only remember them when you're in a good mood. When you're feeling down or unhappy, I'm sure you lose sight of your motivation."</p>
</blockquote>
<p>You can read more of my ramblings here: <a href="https://abishekn.com.np/perspective" target="_blank" rel="noopener noreferrer">abishekn.com.np/perspective</a>.</p>
<p>Here’s the thing: all this hustling we do—working hard for a nice house, a fancy car, or to get better at something—it’s really about <strong>presence</strong>. People always say, <em>“Don’t dwell on the past, it’ll hurt you.”</em> Fair enough. But I’d argue looking too far into the future can mess up your <strong>now</strong> just as much. Every second you spend distracted or lost? It’s gone forever. You don’t get it back.</p>
<p>So, what I’m getting at is this: <strong>focus on the moment</strong>. Enjoy the process. I’m convinced that’s where real joy and happiness hide. Think about it—you forget where you left your keys, you miss an important moment because you’re zoned out, or you finally get something you’ve always wanted and feel that rush of pride. But do you remember how hard you worked for it? Probably not. Success has a way of wiping the slate clean. Then, boom, new desires pop up, and the cycle starts again.</p>
<p>That’s life, right? An endless loop of wanting, chasing, and forgetting. We all know this deep down—it’s nothing groundbreaking. But living it? Actually <strong>staying present</strong>? That’s the tricky part.</p>
<p>I’ll be real with you—I’m not even sure where I’m going with this. It’s just a stream of thoughts, typed out for fun. Hope you enjoyed it, though! Thanks for reading, and catch you in the next one.</p>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Philosophy" term="Philosophy"/>
        <category label="Non Technical" term="Non Technical"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello World]]></title>
        <id>https://blog.abishekn.com.np/blog/first-blog</id>
        <link href="https://blog.abishekn.com.np/blog/first-blog"/>
        <updated>2024-04-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Hello! This is my first blog post.]]></summary>
        <content type="html"><![CDATA[<p>Hello! This is my first blog post.</p>
<p>More content goes here...</p>]]></content>
        <author>
            <name>Abishek Neupane</name>
            <uri>https://github.com/virtualabishek</uri>
        </author>
        <category label="Technical" term="Technical"/>
    </entry>
</feed>