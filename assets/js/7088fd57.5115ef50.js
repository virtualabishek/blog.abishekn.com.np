"use strict";(self.webpackChunkblog_site=self.webpackChunkblog_site||[]).push([[9408],{1079:e=>{e.exports=JSON.parse('{"permalink":"/blog/how-google-use-spanner-for-distributed-database-management","source":"@site/blog/2025-12-29-google-spanner.md","title":"Spanner - Google solution for distributed database in easier","description":"I explored the paper - Spanner: Google\u2019s Globally Distributed Database. This blog contains about the spanner in easier way to those who wants to learn about it","date":"2025-12-29T00:00:00.000Z","tags":[{"inline":false,"label":"Technical","permalink":"/blog/tags/blog/tags/technical","description":"You can find all technical related blogs here."},{"inline":false,"label":"Database","permalink":"/blog/tags/blog/tags/database","description":"Database concepts, tutorials, and comparisons."},{"inline":false,"label":"Distributed Database","permalink":"/blog/tags/blog/tags/distributed-database","description":"Distributed database systems and concepts."}],"readingTime":4.825,"hasTruncateMarker":false,"authors":[{"name":"Abishek Neupane","title":"Self Learner","url":"https://github.com/virtualabishek","page":{"permalink":"/blog/authors/virtualabishek"},"socials":{"github":"https://github.com/virtualabishek","linkedin":"https://www.linkedin.com/in/virtualabishek/","twitter":"https://twitter.com/virtualabishek"},"imageURL":"https://github.com/virtualabishek.png","key":"virtualabishek"}],"frontMatter":{"slug":"how-google-use-spanner-for-distributed-database-management","title":"Spanner - Google solution for distributed database in easier","authors":["virtualabishek"],"date":"2025-12-29","description":"I explored the paper - Spanner: Google\u2019s Globally Distributed Database. This blog contains about the spanner in easier way to those who wants to learn about it","tags":["technical","database","distrubuted-database"]},"unlisted":false,"prevItem":{"title":"Secure Authentication in NestJS E-Commerce: JWT, Access Tokens, and Refresh Tokens Explained","permalink":"/blog/jwt-access-token-refresh-token-in-nestjs-ecommerce"},"nextItem":{"title":"Understanding Transactions and Locking in PostgreSQL","permalink":"/blog/postgresql-transactions-locking"}}')},7901:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});var t=s(1079),i=s(4848),r=s(8453);const a={slug:"how-google-use-spanner-for-distributed-database-management",title:"Spanner - Google solution for distributed database in easier",authors:["virtualabishek"],date:"2025-12-29",description:"I explored the paper - Spanner: Google\u2019s Globally Distributed Database. This blog contains about the spanner in easier way to those who wants to learn about it",tags:["technical","database","distrubuted-database"]},l="Summary of Spanner: Google's Globally Distributed Database",o={authorsImageUrls:[void 0]},c=[{value:"1. <strong>The Basic Problem Spanner Solves</strong>",id:"1-the-basic-problem-spanner-solves",level:2},{value:"2. <strong>Core Concepts</strong>",id:"2-core-concepts",level:2},{value:"<strong>A. Data Distribution (Sharding)</strong>",id:"a-data-distribution-sharding",level:3},{value:"<strong>B. Replication (Copies)</strong>",id:"b-replication-copies",level:3},{value:"<strong>C. Paxos Consensus</strong>",id:"c-paxos-consensus",level:3},{value:"3. <strong>The TrueTime Innovation</strong>",id:"3-the-truetime-innovation",level:2},{value:"<strong>The Time Problem:</strong>",id:"the-time-problem",level:3},{value:"<strong>TrueTime Solution:</strong>",id:"truetime-solution",level:3},{value:"4. <strong>Transaction Types</strong>",id:"4-transaction-types",level:2},{value:"<strong>Read-Write Transactions</strong> (Strong Consistency)",id:"read-write-transactions-strong-consistency",level:3},{value:"<strong>Snapshot Transactions</strong> (Read-Only, No Locks)",id:"snapshot-transactions-read-only-no-locks",level:3},{value:"5. <strong>Data Organization</strong>",id:"5-data-organization",level:2},{value:"<strong>Directories</strong>",id:"directories",level:3},{value:"<strong>Schema Example</strong>",id:"schema-example",level:3},{value:"6. <strong>How a Write Works (Step-by-Step)</strong>",id:"6-how-a-write-works-step-by-step",level:2},{value:"7. <strong>Key Benefits</strong>",id:"7-key-benefits",level:2},{value:"8. <strong>Real-World Example: Google&#39;s F1</strong>",id:"8-real-world-example-googles-f1",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Overview:"}),"\nSpanner is Google's scalable, globally-distributed database that combines the benefits of traditional relational databases with massive scalability across datacenters worldwide."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Features:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Global Distribution & Replication"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Shards data across multiple datacenters globally using Paxos consensus"}),"\n",(0,i.jsx)(n.li,{children:"Automatic failover and resharding"}),"\n",(0,i.jsx)(n.li,{children:"Configurable replication (typically 3-5 replicas)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"TrueTime API"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Novel time API that explicitly exposes clock uncertainty"}),"\n",(0,i.jsx)(n.li,{children:"Uses GPS and atomic clocks for synchronization"}),"\n",(0,i.jsx)(n.li,{children:"Typical uncertainty (\u03b5) is 1-7ms"}),"\n",(0,i.jsx)(n.li,{children:"Enables strong consistency guarantees"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Transaction Support"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"External consistency"})," (linearizability) for distributed transactions"]}),"\n",(0,i.jsx)(n.li,{children:"Lock-free snapshot transactions"}),"\n",(0,i.jsx)(n.li,{children:"Non-blocking reads in the past"}),"\n",(0,i.jsx)(n.li,{children:"Two-phase commit across Paxos groups"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Data Model"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Semi-relational tables with SQL-like query language"}),"\n",(0,i.jsx)(n.li,{children:"Hierarchical schema with directories as units of data placement"}),"\n",(0,i.jsx)(n.li,{children:"Versioned key-value storage with automatic timestamps"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Performance Highlights:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Write latency: ~15ms (including commit wait)"}),"\n",(0,i.jsx)(n.li,{children:"Snapshot read latency: ~1.4ms"}),"\n",(0,i.jsx)(n.li,{children:"Successfully handles datacenter failures with minimal disruption"}),"\n",(0,i.jsx)(n.li,{children:"First major customer (F1 - Google's advertising backend) migrated from sharded MySQL"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Significance:"}),"\nFirst system to provide external consistency and globally-consistent reads at global scale, making it suitable for applications requiring strong consistency across continents."]}),"\n",(0,i.jsxs)(n.h2,{id:"1-the-basic-problem-spanner-solves",children:["1. ",(0,i.jsx)(n.strong,{children:"The Basic Problem Spanner Solves"})]}),"\n",(0,i.jsx)(n.p,{children:"Imagine you have a banking app used worldwide. You need:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data everywhere"}),": Users in Japan and USA both need fast access"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consistency"}),": If someone transfers money, both accounts must update correctly"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Availability"}),": System must work even if a datacenter fails"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Traditional databases struggle with this. Spanner solves it."}),"\n",(0,i.jsxs)(n.h2,{id:"2-core-concepts",children:["2. ",(0,i.jsx)(n.strong,{children:"Core Concepts"})]}),"\n",(0,i.jsx)(n.h3,{id:"a-data-distribution-sharding",children:(0,i.jsx)(n.strong,{children:"A. Data Distribution (Sharding)"})}),"\n",(0,i.jsx)(n.p,{children:"Think of your data like a library:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Instead of one giant building (single server), you have multiple branches (servers) worldwide"}),"\n",(0,i.jsx)(n.li,{children:"Each branch holds certain books (data shards)"}),"\n",(0,i.jsx)(n.li,{children:"Users go to their nearest branch for faster service"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"User Data Split Across Servers:\nServer 1 (USA): Users A-M\nServer 2 (Europe): Users N-Z\nServer 3 (Asia): Backup copies\n"})}),"\n",(0,i.jsx)(n.h3,{id:"b-replication-copies",children:(0,i.jsx)(n.strong,{children:"B. Replication (Copies)"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Each piece of data exists in ",(0,i.jsx)(n.strong,{children:"multiple locations"})," (typically 3-5 copies)"]}),"\n",(0,i.jsx)(n.li,{children:"If one datacenter fails, others keep working"}),"\n",(0,i.jsx)(n.li,{children:"Like having backup copies of important documents in different safe deposit boxes"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"c-paxos-consensus",children:(0,i.jsx)(n.strong,{children:"C. Paxos Consensus"})}),"\n",(0,i.jsxs)(n.p,{children:["This is how servers ",(0,i.jsx)(n.strong,{children:"agree"})," on what data is correct:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'Simple Example:\n1. Server A wants to write "Balance = $100"\n2. It asks other servers: "Can I write this?"\n3. Majority (3 out of 5) must agree\n4. Once majority agrees, write is committed\n5. All servers eventually get updated\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"3-the-truetime-innovation",children:["3. ",(0,i.jsx)(n.strong,{children:"The TrueTime Innovation"})]}),"\n",(0,i.jsx)(n.p,{children:'This is Spanner\'s "secret sauce" for handling time across the globe.'}),"\n",(0,i.jsx)(n.h3,{id:"the-time-problem",children:(0,i.jsx)(n.strong,{children:"The Time Problem:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'Server in USA: "Transaction happened at 10:00:00"\nServer in Japan: "Transaction happened at 10:00:01"\nBut which really came first? Clocks aren\'t perfectly synchronized!\n'})}),"\n",(0,i.jsx)(n.h3,{id:"truetime-solution",children:(0,i.jsx)(n.strong,{children:"TrueTime Solution:"})}),"\n",(0,i.jsx)(n.p,{children:'Instead of saying "it\'s exactly 10:00:00", TrueTime says:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'"It\'s between 10:00:00.003 and 10:00:00.007"\n(uncertainty range)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"How it works:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Uses GPS satellites and atomic clocks"}),"\n",(0,i.jsx)(n.li,{children:"Admits uncertainty explicitly"}),"\n",(0,i.jsx)(n.li,{children:"Waits out uncertainty when needed for correctness"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Example:\nTransaction 1 commits at time [10:00:00.000 - 10:00:00.007]\nSpanner waits until 10:00:00.007 passes\nThen Transaction 2 can start at [10:00:00.008 - 10:00:00.015]\nNow we KNOW Transaction 1 finished before Transaction 2 started!\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"4-transaction-types",children:["4. ",(0,i.jsx)(n.strong,{children:"Transaction Types"})]}),"\n",(0,i.jsxs)(n.h3,{id:"read-write-transactions-strong-consistency",children:[(0,i.jsx)(n.strong,{children:"Read-Write Transactions"})," (Strong Consistency)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Example: Transfer $50 from Account A to Account B\n\n1. Lock both accounts\n2. Read current balances\n3. Calculate new balances\n4. Get timestamp from TrueTime\n5. Write changes to multiple servers (Paxos)\n6. Wait for commit-wait (ensures ordering)\n7. Release locks\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"snapshot-transactions-read-only-no-locks",children:[(0,i.jsx)(n.strong,{children:"Snapshot Transactions"})," (Read-Only, No Locks)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'Example: Generate monthly report\n\n1. Pick a timestamp in the past (e.g., "end of last month")\n2. Read data as it existed at that exact time\n3. No locks needed - just reading history\n4. Can read from any replica that\'s up-to-date\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"5-data-organization",children:["5. ",(0,i.jsx)(n.strong,{children:"Data Organization"})]}),"\n",(0,i.jsx)(n.h3,{id:"directories",children:(0,i.jsx)(n.strong,{children:"Directories"})}),"\n",(0,i.jsx)(n.p,{children:"Think of directories as folders that keep related data together:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'Directory for User "Alice":\n\u251c\u2500\u2500 Profile Info\n\u251c\u2500\u2500 Purchase History\n\u2514\u2500\u2500 Preferences\n\nThis whole directory:\n- Stays together on same servers\n- Moves as a unit if needed\n- Can be replicated to different locations\n'})}),"\n",(0,i.jsx)(n.h3,{id:"schema-example",children:(0,i.jsx)(n.strong,{children:"Schema Example"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Users table\nCREATE TABLE Users {\n  user_id INT64,\n  email STRING,\n  name STRING\n} PRIMARY KEY (user_id);\n\n-- Orders table (nested under Users)\nCREATE TABLE Orders {\n  user_id INT64,\n  order_id INT64,\n  amount FLOAT\n} PRIMARY KEY (user_id, order_id),\n  INTERLEAVE IN PARENT Users;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"INTERLEAVE"})," means orders are stored physically close to their user - faster queries!"]}),"\n",(0,i.jsxs)(n.h2,{id:"6-how-a-write-works-step-by-step",children:["6. ",(0,i.jsx)(n.strong,{children:"How a Write Works (Step-by-Step)"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"User wants to update their email:\n\n1. REQUEST arrives at nearest Spanner server\n   \n2. SERVER identifies which Paxos group owns this data\n   \n3. LEADER of that group receives the request\n   \n4. ACQUIRE LOCKS on the data\n   \n5. PROPOSE change to other replicas via Paxos\n   \"I want to write: user_123.email = 'new@email.com'\"\n   \n6. REPLICAS vote (need majority to agree)\n   \n7. TIMESTAMP assigned using TrueTime\n   timestamp = TT.now().latest\n   \n8. COMMIT WAIT - wait until TT.after(timestamp) is true\n   (ensures external consistency)\n   \n9. APPLY the change to all replicas\n   \n10. RELEASE LOCKS\n    \n11. RETURN success to user\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"7-key-benefits",children:["7. ",(0,i.jsx)(n.strong,{children:"Key Benefits"})]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Feature"}),(0,i.jsx)(n.th,{children:"What It Means"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"External Consistency"})}),(0,i.jsx)(n.td,{children:"Transactions appear in the order they actually happened in real time"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Global Availability"})}),(0,i.jsx)(n.td,{children:"Works even if entire datacenters fail"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"SQL Support"})}),(0,i.jsx)(n.td,{children:"Use familiar database queries"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Automatic Scaling"})}),(0,i.jsx)(n.td,{children:"Add servers without downtime"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Strong Consistency"})}),(0,i.jsx)(n.td,{children:'No "eventual consistency" surprises'})]})]})]}),"\n",(0,i.jsxs)(n.h2,{id:"8-real-world-example-googles-f1",children:["8. ",(0,i.jsx)(n.strong,{children:"Real-World Example: Google's F1"})]}),"\n",(0,i.jsx)(n.p,{children:"Google's advertising system uses Spanner:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Before"}),": Manually sharded MySQL (nightmare to manage)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"After"}),": Spanner handles sharding automatically"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scale"}),": Tens of terabytes, millions of operations/second"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Replication"}),": 5 replicas across US (2 west coast, 3 east coast)"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var t=s(6540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);